<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Explorer - Dashboard</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { margin: 0; padding: 0; font-family: Arial; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { background: #2a2a2a; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .json-display { background: #000; border: 1px solid #333; border-radius: 5px; padding: 15px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .warning { color: #ffd43b; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const FirebaseExplorer = () => {
            const [firebaseReady, setFirebaseReady] = useState(false);
            const [logs, setLogs] = useState([]);
            const [collections, setCollections] = useState({});

            const firebaseConfig = {
                apiKey: "AIzaSyC4TCs_jnYgbLautTgKHZloeMnV3RuVKrM",
                authDomain: "dashboard-prospeccao-ativa.firebaseapp.com",
                projectId: "dashboard-prospeccao-ativa",
                storageBucket: "dashboard-prospeccao-ativa.firebasestorage.app",
                messagingSenderId: "878548277840",
                appId: "1:878548277840:web:70a7de867f66dbcb5e8f55"
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [...prev, { timestamp, message, type }]);
                console.log(`${type.toUpperCase()}: ${message}`);
            };

            useEffect(() => {
                const initFirebase = async () => {
                    try {
                        if (!firebase.apps.length) {
                            firebase.initializeApp(firebaseConfig);
                        }
                        
                        const auth = firebase.auth();
                        await auth.signInAnonymously();
                        setFirebaseReady(true);
                        addLog("Firebase conectado com sucesso", "success");
                        
                    } catch (error) {
                        addLog(`Erro no Firebase: ${error.message}`, "error");
                    }
                };

                initFirebase();
            }, []);

            const exploreCollection = async (collectionPath) => {
                if (!firebaseReady) return;

                addLog(`ğŸ” Explorando coleÃ§Ã£o: ${collectionPath}`);
                
                try {
                    const db = firebase.firestore();
                    const snapshot = await db.collection(collectionPath).get();
                    
                    addLog(`ğŸ“Š Encontrados ${snapshot.size} documentos em '${collectionPath}'`);
                    
                    const documents = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        documents.push({
                            id: doc.id,
                            data: data
                        });
                        addLog(`ğŸ“„ Documento: ${doc.id} | Dados: ${JSON.stringify(data).substring(0, 100)}...`);
                    });
                    
                    setCollections(prev => ({
                        ...prev,
                        [collectionPath]: documents
                    }));
                    
                } catch (error) {
                    addLog(`âŒ Erro ao explorar '${collectionPath}': ${error.message}`, "error");
                }
            };

            const exploreNestedPath = async (path) => {
                if (!firebaseReady) return;

                addLog(`ğŸ” Explorando path aninhado: ${path}`);
                
                try {
                    const db = firebase.firestore();
                    const docRef = db.doc(path);
                    const doc = await docRef.get();
                    
                    if (doc.exists) {
                        addLog(`âœ… Documento encontrado em: ${path}`);
                        addLog(`ğŸ“„ Dados: ${JSON.stringify(doc.data(), null, 2)}`);
                        
                        setCollections(prev => ({
                            ...prev,
                            [path]: [{ id: doc.id, data: doc.data() }]
                        }));
                    } else {
                        addLog(`âŒ Documento nÃ£o encontrado em: ${path}`, "warning");
                    }
                    
                } catch (error) {
                    addLog(`âŒ Erro ao acessar '${path}': ${error.message}`, "error");
                }
            };

            const testSpecificDocument = async (docPath) => {
                addLog(`ğŸ¯ Testando documento especÃ­fico: ${docPath}`);
                await exploreNestedPath(docPath);
            };

            const clearLogs = () => {
                setLogs([]);
                setCollections({});
            };

            return (
                <div className="container">
                    <h1>ğŸ”¥ Firebase Explorer - Dashboard ProspecÃ§Ã£o</h1>
                    
                    <div className="section">
                        <h2>ğŸ”§ Controles</h2>
                        <button onClick={() => exploreCollection('prospeccaoDiaria')} disabled={!firebaseReady}>
                            ğŸ“Š Explorar: prospeccaoDiaria
                        </button>
                        <button onClick={() => exploreCollection('artifacts')} disabled={!firebaseReady}>
                            ğŸ“Š Explorar: artifacts
                        </button>
                        <button onClick={() => exploreNestedPath('artifacts/dashboard-prospeccao-ativa')} disabled={!firebaseReady}>
                            ğŸ“‚ Artifacts â†’ Dashboard
                        </button>
                        <button onClick={() => exploreNestedPath('artifacts/dashboard-prospeccao-ativa/public/data')} disabled={!firebaseReady}>
                            ğŸ“‚ Public â†’ Data
                        </button>
                        <button onClick={() => testSpecificDocument('prospeccaoDiaria/2025-06-02')} disabled={!firebaseReady}>
                            ğŸ¯ Teste: 2025-06-02
                        </button>
                        <button onClick={() => testSpecificDocument('artifacts/dashboard-prospeccao-ativa/public/data/salesDashboardData/funnelSummary')} disabled={!firebaseReady}>
                            ğŸ¯ Teste: funnelSummary
                        </button>
                        <button onClick={clearLogs}>ğŸ—‘ï¸ Limpar</button>
                    </div>

                    <div className="section">
                        <h2>ğŸ“‹ Logs de ExploraÃ§Ã£o</h2>
                        <div className="json-display">
                            {logs.map((log, index) => (
                                <div key={index} className={log.type === 'error' ? 'error' : log.type === 'success' ? 'success' : log.type === 'warning' ? 'warning' : ''}>
                                    [{log.timestamp}] {log.message}
                                </div>
                            ))}
                        </div>
                    </div>

                    {Object.keys(collections).length > 0 && (
                        <div className="section">
                            <h2>ğŸ“Š Dados Encontrados</h2>
                            {Object.entries(collections).map(([path, docs]) => (
                                <div key={path}>
                                    <h3>ğŸ“ {path}</h3>
                                    <div className="json-display">
                                        {JSON.stringify(docs, null, 2)}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    <div className="section">
                        <h2>ğŸ¯ Paths Conhecidos para Testar</h2>
                        <ul>
                            <li><code>prospeccaoDiaria</code> - ColeÃ§Ã£o principal de dados diÃ¡rios</li>
                            <li><code>prospeccaoDiaria/2025-06-02</code> - Documento especÃ­fico que vi no Firebase</li>
                            <li><code>artifacts</code> - ColeÃ§Ã£o de artefatos</li>
                            <li><code>artifacts/dashboard-prospeccao-ativa</code> - Documento do projeto</li>
                            <li><code>artifacts/dashboard-prospeccao-ativa/public/data/salesDashboardData/funnelSummary</code> - Onde o frontend espera dados</li>
                        </ul>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FirebaseExplorer />);
    </script>
</body>
</html>
